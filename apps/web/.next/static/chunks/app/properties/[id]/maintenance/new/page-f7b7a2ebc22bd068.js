(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[12],{9735:function(e,t,n){Promise.resolve().then(n.bind(n,68))},68:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return d}});var a=n(7573),r=n(7653),s=n(1867),i=n(1695),l=n(8146);function d(e){let{params:t}=e,n=(0,i.useRouter)(),[d,o]=(0,r.useState)(null),[c,u]=(0,r.useState)([]),[m,g]=(0,r.useState)(!0),[x,h]=(0,r.useState)(!1),[p,b]=(0,r.useState)(""),[f,j]=(0,r.useState)({interval_id:"",custom_name:"",brand:"",model:"",installation_date:"",last_maintenance:""});(0,r.useEffect)(()=>{y()},[t.id]);let y=async()=>{let{data:{session:e}}=await s.O.auth.getSession();if(!e){n.push("/login");return}let{data:a}=await s.O.from("properties").select("*").eq("id",t.id).single();if(!a||a.user_id!==e.user.id){b("Immobilie nicht gefunden"),g(!1);return}o(a);let{data:r}=await s.O.from("maintenance_intervals").select("*").order("category",{ascending:!0}).order("component",{ascending:!0});u(r||[]),g(!1)},v=(e,t)=>{let n=new Date(new Date(e));return n.setMonth(n.getMonth()+t),n.toISOString().split("T")[0]},_=async e=>{e.preventDefault(),h(!0),b("");try{let e=c.find(e=>e.id===f.interval_id);if(!e){b("Bitte w\xe4hle einen Wartungstyp aus"),h(!1);return}let n=v(f.last_maintenance,e.interval_months),{error:a}=await s.O.from("components").insert({property_id:t.id,interval_id:f.interval_id,custom_name:f.custom_name||null,brand:f.brand||null,model:f.model||null,installation_date:f.installation_date||null,last_maintenance:f.last_maintenance,next_maintenance:n,is_active:!0});if(a){b(a.message),h(!1);return}window.location.href="/properties/".concat(t.id)}catch(e){b(e.message||"Ein Fehler ist aufgetreten"),h(!1)}};if(m)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"L\xe4dt..."})]})});if(p&&!d)return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Fehler"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:p}),(0,a.jsx)(l.default,{href:"/dashboard",className:"text-indigo-600 hover:text-indigo-800 font-medium",children:"← Zur\xfcck zum Dashboard"})]})});let N=c.find(e=>e.id===f.interval_id),w=c.reduce((e,t)=>(e[t.category]||(e[t.category]=[]),e[t.category].push(t),e),{});return(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-12 px-4",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)(l.default,{href:"/properties/".concat(t.id),className:"text-indigo-600 hover:text-indigo-800 font-medium mb-2 inline-block",children:["← Zur\xfcck zu ",null==d?void 0:d.name]}),(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Wartung hinzuf\xfcgen"}),(0,a.jsx)("p",{className:"text-gray-600",children:"W\xe4hle einen Wartungstyp und trage die letzte Wartung ein"})]}),p&&(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 text-red-600 p-4 rounded-lg mb-6",children:["⚠️ ",p]}),(0,a.jsxs)("form",{onSubmit:_,className:"bg-white p-8 rounded-lg shadow space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Wartungstyp *"}),(0,a.jsxs)("select",{value:f.interval_id,onChange:e=>j({...f,interval_id:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",required:!0,children:[(0,a.jsx)("option",{value:"",children:"Bitte w\xe4hlen..."}),Object.keys(w).map(e=>(0,a.jsx)("optgroup",{label:e,children:w[e].map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.component," (",1===e.interval_months?"monatlich":"alle ".concat(e.interval_months," Monate"),")",e.legal_requirement&&" ⚖️"]},e.id))},e))]}),N&&(0,a.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Info:"})," ",N.description]}),N.legal_requirement&&(0,a.jsxs)("p",{className:"text-sm text-blue-800 mt-1",children:["⚖️ ",(0,a.jsx)("strong",{children:"Gesetzlich vorgeschrieben"})," ",N.oib_reference&&"(".concat(N.oib_reference,")")]}),N.cost_estimate_from&&(0,a.jsxs)("p",{className:"text-sm text-blue-800 mt-1",children:["\uD83D\uDCB0 Kosten: ca. €",N.cost_estimate_from," - €",N.cost_estimate_to]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Eigene Bezeichnung (optional)"}),(0,a.jsx)("input",{type:"text",placeholder:"z.B. Gastherme Keller",value:f.custom_name,onChange:e=>j({...f,custom_name:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Hilft dir, die Komponente zu identifizieren"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Marke (optional)"}),(0,a.jsx)("input",{type:"text",placeholder:"z.B. Vaillant",value:f.brand,onChange:e=>j({...f,brand:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Modell (optional)"}),(0,a.jsx)("input",{type:"text",placeholder:"z.B. ecoTEC plus",value:f.model,onChange:e=>j({...f,model:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Installationsdatum (optional)"}),(0,a.jsx)("input",{type:"date",value:f.installation_date,onChange:e=>j({...f,installation_date:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-bold text-gray-700 mb-2",children:"Letzte Wartung *"}),(0,a.jsx)("input",{type:"date",value:f.last_maintenance,onChange:e=>j({...f,last_maintenance:e.target.value}),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent",max:new Date().toISOString().split("T")[0],required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Wann wurde die letzte Wartung durchgef\xfchrt?"})]}),f.last_maintenance&&N&&(0,a.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm font-medium text-green-900",children:["\uD83D\uDCC5 N\xe4chste Wartung f\xe4llig: ",(0,a.jsx)("strong",{children:v(f.last_maintenance,N.interval_months)})]})}),(0,a.jsxs)("div",{className:"flex gap-4 pt-4",children:[(0,a.jsx)("button",{type:"submit",disabled:x,className:"flex-1 bg-indigo-600 text-white py-3 px-6 rounded-lg font-bold hover:bg-indigo-700 transition disabled:opacity-50",children:x?"Wird gespeichert...":"✅ Wartung hinzuf\xfcgen"}),(0,a.jsx)(l.default,{href:"/properties/".concat(t.id),className:"px-6 py-3 border border-gray-300 rounded-lg font-bold text-gray-700 hover:bg-gray-50 transition text-center",children:"Abbrechen"})]})]})]})})}},1867:function(e,t,n){"use strict";n.d(t,{O:function(){return a}});let a=(0,n(2978).eI)("https://cfggqkjogprlzikzxijc.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNmZ2dxa2pvZ3BybHppa3p4aWpjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA2MzQzMDksImV4cCI6MjA3NjIxMDMwOX0.gyIVDXpqTWpZjKzE1qmI-ObeIb0D6pIoZPfwu3gtzpk")}},function(e){e.O(0,[978,738,293,528,744],function(){return e(e.s=9735)}),_N_E=e.O()}]);